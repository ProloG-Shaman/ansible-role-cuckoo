---

# - name: Add nginx apt key
#   become: yes
#   become_method: sudo
#   apt_key:
#     url='http://nginx.org/keys/nginx_signing.key'
  
# - name: Add nginx apt repo
#   become: yes
#   become_method: sudo
#   apt_repository:
#     repo="deb http://nginx.org/packages/{{ ansible_lsb.id|lower }}/ {{ ansible_lsb.codename }} nginx"
#     update_cache=yes

# - name: Disable default servers
#   become: yes
#   become_method: sudo
#   file:
#     path=/etc/nginx/conf.d/{{ item.path }}
#     state=absent
#   with_items:
#     - { path: 'default.conf' }
#     - { path: 'example_ssl.conf' }


- name: Install uwsgi
  become: yes
  become_method: sudo
  package:
    name:
      - uwsgi-plugin-python
      - uwsgi
    state: latest


- name: Install Cuckoo Sandbox API uWSGI configuration
  become: yes
  become_method: sudo
  template: src=uwsgi.cuckoo.ini.j2 dest=/etc/uwsgi/apps-available/cuckoo.ini owner=root group=root mode=0644
  notify: restart uwsgi
  
- name: Enable Cuckoo Sandbox API uWSGI Configuration
  become: yes
  become_method: sudo
  file: src=/etc/uwsgi/apps-available/cuckoo.ini dest=/etc/uwsgi/apps-enabled/cuckoo.ini state=link
  notify: restart uwsgi
  
- name: Install Cuckoo Sandbox API NGINX Configuration
  become: yes
  become_method: sudo
  template: src=nginx.cuckoo-api.conf.j2 dest=/etc/nginx/conf.d/cuckoo-api.conf owner=root group=root mode=0644
  notify: restart nginx
